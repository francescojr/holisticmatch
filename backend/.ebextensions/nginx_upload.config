files:
  "/etc/nginx/conf.d/01_client_max_body_size.conf":
    mode: "000644"
    owner: root
    group: root
    content: |
      # Allow uploads up to 250MB
      client_max_body_size 250M;
      
      # Also set timeout for large uploads
      client_body_timeout 300s;
      proxy_connect_timeout 300s;
      proxy_send_timeout 300s;
      proxy_read_timeout 300s;

commands:
  00_backup_nginx:
    command: "cp /etc/nginx/nginx.conf /etc/nginx/nginx.conf.bak || true"
    ignoreErrors: true
  01_create_nginx_config:
    command: "mkdir -p /etc/nginx/conf.d"
  02_verify_config:
    command: "nginx -t"
  03_reload_nginx:
    command: "systemctl reload nginx"
  04_verify_running:
    command: "systemctl is-active nginx"
